version: 2

project_name: intent

before:
  hooks:
    - go mod tidy

builds:
  - id: intent
    main: ./cmd/intent
    env: [CGO_ENABLED=0]
    goos: [darwin, linux]
    goarch: [amd64, arm64]
    ldflags:
      - -s -w
      - -X github.com/intentregistry/intent-cli/internal/version.Version={{.Version}}
      - -X github.com/intentregistry/intent-cli/internal/version.Commit={{.Commit}}
      - -X github.com/intentregistry/intent-cli/internal/version.Date={{.Date}}

archives:
  - id: tarballs
    formats: [tar.gz]
    name_template: "intent-{{ .Os }}-{{ .Arch }}"
    files:
      - README.md

checksum:
  name_template: "checksums.txt"

brews:
  - name: intent-cli
    repository:
      owner: intentregistry
      name: homebrew-tap
      token: "{{ .Env.HOMEBREW_GITHUB_TOKEN }}"
      branch: main
      # Disabled PR for now to go faster
      # pull_request:
      #   enabled: true
      #   base: main
    directory: Formula
    description: "IntentRegistry CLI â€” publish and install AI Intents"
    homepage: "https://intentregistry.com"
    license: "MIT"
    commit_author:
      name: "Sergio Pulido"
      email: "sergio@intentregistry.com"
    commit_msg_template: "chore(brew): update {{ .ProjectName }} to {{ .Tag }}"
    install: |
      bin.install "intent"
      generate_completions_from_executable(bin/"intent", "completion")
    test: |
      system "#{bin}/intent", "--version"

changelog:
  use: github